# "story_line2"

Данная часть пректа содежит в себе следующее:
- данные о зависимостях;
- скрипты для сборки проекта
- скрипты для развертывания тестового и рабочего серверов/инфраструктуры серверов.

## Данные о зависимостях
Основные скрипты для управления зависимостями проекта расположены в
"buildSrc/dependencies.gradle". Не допускается "растекание" настроек зависимостей по другим конфигурационным файлам. Единственным исключением являются номера версий ПО в
настройках стендов.
## Скрипты для сборки проекта
Сборка проекта осуществляется с помощью gradle. Основные скрипты для сборки
проекта расположены в "buildSrc/build-tasks.gradle".

## Скрипты для развертывания тестового и рабочего серверов/инфраструктуры серверов.
### Основные требования к скриптам:
- полная автоматизация
- использование gradle
- использование [docker-compose](https://docs.docker.com/compose/) для управления
группой контейнеров
- использование [docker](https://docs.docker.com/) (один контейнер на сервис)
- использование [puppet](https://puppet.com/) (для управления конфигурациями и
 структурой ОС внутри контейнера)

### Общией замечания о сборке и запуске стенда
- стенд представляет собой коллекцию docker-контейнеров,
выполняющихся на одной или нескольких машинах (тестовый - на одной)
- существует несколько видов стэнда:
	* dev - стенд для разработки в котором всё ПО запускается вручную, кроме
	инфраструктурных компонентов
	* test - стенд для тестирования в котром все компоненты запускаются в полном
	объме, но стенд "заточен" под задачи тестирования
	* prod - полностью продуктивный стэнд
- сборка стенда осуществляется с помощью задач gradle-скрипта
("buildSrc/build-tasks.gradle")
- все параметры скриптов считываются из нескольких конфигурационных файлов,
используемых в зависимости от типа стенда (dev/test/prod)
- ВСЕ параметры создаваемых стэндов определены в одном или нескольких
properties-файлах (разных в зависимости от типа стенда)
- ВСЕ параметры создаваемых контейнеров в первую очередь определяются properties,
потом в Dockerfile, потом docker-compose.yml
- тип стенда по-умолчанию (dev) может быть переопределён параметром к скрипту
`gradle -Pproject.ext.stand_type=test`

### Процедура сборки и запуска стенда
1. Осуществляется сборка проекта (для test-стэнда)
1. формируются Dockerfile для контейнера (с учетом параметров)
1. запускается docker-compose (в зависимости от вида стенда)
	2. Выполняется скачивание необходимых образов
	2. выполняются скрипты puppet для подготовки среды в нем
	2. осуществляется запуск контейнера (docker 'ENTRYPOINT')
1. Осуществляется запуск тестов (для test-стэнда)
